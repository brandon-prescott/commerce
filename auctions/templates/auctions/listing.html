{% extends "auctions/layout.html" %}

{% block body %}
    <h2>Listing: {{ listing.title }}</h2>
    {% if listing.is_active == False %}
        <div class="alert alert-danger" role="alert">
            This auction is now closed
        </div>
    {% endif %}

    {% if user.is_authenticated and listing.is_active == True %}
        <div>
            <form action="{% url 'watchlist' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="listing_id" value="{{ listing.id }}">
                {% if in_watchlist == True %}
                    <input type="hidden" name="watchlist_action" value="remove">
                    <button type="submit">Remove from Watchlist</button>
                {% else %}
                    <input type="hidden" name="watchlist_action" value="add">
                    <button type="submit">Add to Watchlist</button>
                {% endif %}

            </form>
        </div>
    {% endif %}
    <div>
        <img src="{{ listing.image_url }}" onerror="this.onerror=null;this.src='https://www.survivorsuk.org/wp-content/uploads/2017/01/no-image.jpg';" width="400px" height="auto">
    </div>
    <div>
        {{ listing.description }}
    </div>
    <div>
        Current Price: ${{ listing.price }}
    </div>
    <div>
        {% if user.is_authenticated and listing.is_active == True %}
            <form action="{% url 'bid' %}" method="POST">
                {% csrf_token %}
                <div class="form-group">
                    {{ bid_form.amount }}
                </div>  
                <button type="submit" class="btn btn-primary">Place Bid</button>
                <input type="hidden" name="listing_id" value="{{ listing.id }}">
            </form>
        {% endif %}
    </div>
    <div>
        <h3>Details</h3>
    </div>
    <div>
        <ul>
            <li>Listed by: {{ seller_username }}</li>
            <li>Category: {{ category }}</li>
        </ul>
    </div>
    <div>
        <h3>Comments</h3>
    </div>
    <div>
        {% if user.is_authenticated and listing.is_active == True %}
            <form action="{% url 'comment' %}" method="POST">
                {% csrf_token %}
                <div class="form-group">
                    {{ comment_form.comment }}
                </div>  
                <button type="submit" class="btn btn-secondary">Add Comment</button>
                <input type="hidden" name="listing_id" value="{{ listing.id }}">
            </form>
        {% endif %}
    </div>
    <hr>
    <div>
        <ul>
            {% for comment in comments %}
                <li>{{ comment.user }}: {{ comment.comment }} ({{ comment.time }})</li>
            {% endfor %}
        </ul>
    </div>
    
{% endblock %}